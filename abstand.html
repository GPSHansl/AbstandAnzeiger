<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Abstand darstellen</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.20/fabric.js"></script>
    <style id="compiled-css" type="text/css">
      .controls {
        float: both;
        position: absolute;
        border: 1px solid blue;
		padding: 5px;
      }
	  .controls p {
		padding: 0;
		margin: 0;
	}
    </style>
  </head>
  <body>
    <canvas id="myCanvas" style="border: 1px solid black;"></canvas>
	<div id="controls" class="controls">
		<p>
			<label><span>Abstand:</span> <input type="range" id="dist_car-control" value="0.1" min="0.1" max="3" step="0.1">&nbsp;(<span id="dist_car-lbl"></span>)</label>
		</p>
		<p>
			<label><span>KFZ Breite:</span> <input type="range" id="car-control" value="2" min="0.6" max="3.0" step="0.01">&nbsp;(<span id="car-lbl"></span>)</label>
		</p>
		<p>
			<label><span>Fahrbahnbreite:</span> <input type="range" id="right_lane-control" value="12" min="0.6" max="15" step="0.1">&nbsp;(<span id="right_lane-lbl"></span>)</label>
		</p>
		<p>
			<label><span>Stra√üenbreite:</span> <input type="range" id="street-control" value="1.5" min="1.5" max="20" step="0.1">&nbsp;(<span id="street-lbl"></span>)</label>
		</p>
		<p>
			<label><span>Radfahrer Breite:</span> <input type="range" id="cyclist-control" value="0.8" min="0.5" max="2.8" step="0.01">&nbsp;(<span id="cyclist-lbl"></span>)</label>
		</p>
		<p>
			<label><span>Abstand Fahrbahnrand:</span> <input type="range" id="dist_right-control" value="0.4" min="-1.0" max="4.0" step="0.01">&nbsp;(<span id="dist_right-lbl"></span>)</label>
		</p>
	</div>
	

    <script type="text/javascript">//<![CDATA[


var width_street = 7.0; // street width in m
var width_right_lane = 3.5; // right lane in m
var width_car = 2.0; // width of the car in m
var width_cyclist = 0.8; // width of the cyclist in m
var width_dist_right = 0.5; // width of the distance to the right street border in m
var width_verge = 0.2; // width of the verge in m
var width_marking = 0.12; // width of markings in m
var width_border = 0.3; // width of a border in m (better visibility)
var width_dist_car = 1.5; // width of the distance car to cyclist in m
var height_cyclist = 1.8; // height of the cyclist in m
var height_car = 1.5; // height of the car in m
var height_street = 0.15; // height of the street in m
var svg_car = "https://www.svgrepo.com/show/24109/car.svg";
var svg_bike = "https://www.svgrepo.com/show/157948/cyclist.svg";
var svg_street = "http://upload.wikimedia.org/wikipedia/commons/d/d2/Svg_example_square.svg";

var $ = function(id) {
  return document.getElementById(id)
};



const col_street = 'rgba(10, 10, 10, 0.9)';
const col_marking = 'rgba(250, 250, 250, 0.9)';

var rect_cyclist = new fabric.Rect({
  fill: col_street,
  selectable: false,
  resizable: false
});
var rect_street = new fabric.Rect({
  fill: col_street,
  selectable: false
});
var rect_street_marking_left = new fabric.Rect({
  fill: col_marking,
  selectable: false
});
var rect_street_marking_right = new fabric.Rect({
  fill: col_marking,
  selectable: false
});
var rect_street_marking_center = new fabric.Rect({
  fill: col_marking,
  selectable: false,
  resizable: false
});
var line_car_left = new fabric.Rect({
  width: 1,
  fill: col_street,
  selectable: false,
  resizable: false
});
var line_car_right = new fabric.Rect({
  width: 1,
  fill: col_street,
  selectable: true,
  resizable: false
});
var rect_car = new fabric.Rect({
  fill: col_street,
  selectable: false,
  resizable: false
});
var text_car = new fabric.Text("car", { fontSize: 12});
var text_distcar = new fabric.Text("distcar", { fontSize: 12});
var text_cyclist = new fabric.Text("cyclist", { fontSize: 12});
var text_lane = new fabric.Text("lane", { fontSize: 12});
var text_street = new fabric.Text("street", { fontSize: 12});


function setRectDims(rect, m_top, m_left, m_width, m_height) {
  rect.top = cP(m_top);
  rect.left = cP(m_left);
  if (m_width)
    rect.width = cP(m_width);
  if (m_height)
    rect.height = cP(m_height);
}

function recalcScene(canvas) {
  width_dist_car = parseFloat($('dist_car-control').value);
  width_car = parseFloat($('car-control').value);
  width_right_lane = parseFloat($('right_lane-control').value);
  width_street = parseFloat($('street-control').value);
  width_dist_right = parseFloat($('dist_right-control').value);
  width_cylist = parseFloat($('cyclist-control').value);
  
  $('dist_car-lbl').textContent = width_dist_car + " m";
  $('car-lbl').textContent = width_car + " m";
  $('right_lane-lbl').textContent = width_right_lane + " m";
  $('street-lbl').textContent = width_street + " m";
  $('dist_right-lbl').textContent = width_dist_right + " m";
  $('cyclist-lbl').textContent = width_cyclist + " m";
  
  const height_max = Math.max(height_car, height_cyclist);
  var m_street_r = width_border + width_street;
  var m_marking_r = m_street_r - width_verge;
  var m_marking_l = m_marking_r - width_marking;
  var m_cyclist_r = m_marking_r - width_dist_right;
  var m_cyclist_l = m_cyclist_r - width_cyclist;
  var m_car_r = m_cyclist_l - width_dist_car;
  var m_car_l = m_car_r - width_car;

  setRectDims(rect_cyclist,
    height_max - height_cyclist,
    m_cyclist_l,
    width_cyclist,
    height_cyclist);
  setRectDims(rect_street,
    height_max,
    width_border,
    width_street,
    height_street);
  setRectDims(rect_street_marking_center,
    height_max - height_street * 0.2,
    m_marking_l - width_right_lane - width_marking,
    width_marking,
    height_street);
  setRectDims(rect_street_marking_right,
    height_max - height_street * 0.2,
    m_marking_l,
    width_marking,
    height_street);
  setRectDims(rect_street_marking_left,
    height_max - height_street * 0.2,
    width_border + width_verge,
    width_marking,
    height_street);
  setRectDims(line_car_left,
    height_max - height_car,
    m_car_l,
    null,
    height_car + 2 * height_street);
  setRectDims(line_car_right,
    height_max - height_car,
    m_car_r,
    null,
    height_car + 2 * height_street);
  setRectDims(rect_car,
    height_max - height_car,
    m_car_l,
    width_car,
    height_car);


	text_car.text = width_car+ " m";
	text_car.top = cP(height_max + 2*height_street);
	text_car.left = cP((m_car_l + m_car_r)/2) - text_car.width/2;
	
	text_distcar.text = width_dist_car+ " m";
	text_distcar.top = cP(height_max + 2*height_street);
	text_distcar.left = cP((m_car_r + m_cyclist_l)/2) - text_distcar.width/2;

	text_cyclist.text = width_cyclist + " m";
	text_cyclist.top = cP(height_max + 2*height_street);
	text_cyclist.left = cP((m_cyclist_l + m_cyclist_r)/2) - text_cyclist.width/2;

	canvas.renderAll();
}
var canvas;
(function() {

	var cnvs = $('myCanvas');
	cnvs.width = window.innerWidth - 30;
	cnvs.height = window.innerHeight - 30;
	cnvs.top = 15;
	cnvs.left = 15;

    var controls = $('controls'); 
	controls.style.left = '15px'; 
	controls.style.top = (cnvs.height - controls.offsetHeight) + 'px';

	canvas = this.__canvas = new fabric.Canvas('myCanvas');
	fabric.Object.prototype.transparentCorners = false;


	canvas.add(rect_cyclist);
	canvas.add(rect_street);
	canvas.add(rect_street_marking_left);
	canvas.add(rect_street_marking_right);
	canvas.add(rect_street_marking_center);
	canvas.add(line_car_left);
	canvas.add(line_car_right);
	canvas.add(rect_car);
    canvas.add(text_car);
    canvas.add(text_distcar);
    canvas.add(text_cyclist);
    canvas.add(text_lane);
    canvas.add(text_street);

	var cyclistControl = $('cyclist-control');
	var distCarControl = $('dist_car-control');
	var carControl = $('car-control');
	var rightLaneControl = $('right_lane-control');
	var streetControl = $('street-control');
	var distRightControl = $('dist_right-control');

	cyclistControl.oninput = function() {
		recalcScene(canvas);
	};
	distCarControl.oninput = function() {
		recalcScene(canvas);
	};
	carControl.oninput = function() {
		recalcScene(canvas);
	};
	rightLaneControl.oninput = function() {
		recalcScene(canvas);
	};
	streetControl.oninput = function() {
		recalcScene(canvas);
	};
	distRightControl.oninput = function() {
		recalcScene(canvas);
	};

	cyclistControl.value = width_cyclist;
	carControl.value = width_car;
	rightLaneControl.value = width_right_lane;
	streetControl.value = width_street;
	distCarControl.value = width_dist_car;
	distRightControl.value = width_dist_right;

	recalcScene(canvas);	
})();

const imageUrls = [
  "https://www.svgrepo.com/show/24109/car.svg",
  "https://www.svgrepo.com/show/157948/cyclist.svg",
  "https://www.svgrepo.com/show/322952/person.svg"
];

function cP(meters) {
	var canvas = $("myCanvas");
	var fullwidth_m = width_border * 2 + width_street;
	var m_per_pixel = canvas.width / fullwidth_m;
	return meters * m_per_pixel;
}



  //]]></script>

	</body>
</html>
  
